<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ article['Title'] }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .article_content {
      font-size: medium;
    }

    .label-badge {
      width: 26px;
      height: 26px;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .recommendation-card {
      cursor: pointer;
      transition: transform 0.2s ease-in-out;
    }

    .recommendation-card:hover {
      transform: translateY(-5px);
    }
  </style>
</head>
<body class="container mt-5">
    {% if debug %}
<div class="alert alert-warning">
  <strong>DEBUG:</strong><br>
  article_id: {{ article['index'] }}<br>
  label_shown_ids: {{ label_shown_ids }}<br>
  condition: {{ condition }}<br>
  show_label: {{ show_label }}
</div>
{% endif %}

<div class="d-flex justify-content-center mb-4">
  <div class="alert alert-primary text-center h4 mb-0 px-4 py-3" role="alert">
    <strong>Task:</strong> Please read the article carefully, then choose one of the recommended related articles below.
  </div>
</div>

<div class="mx-auto" style="max-width: 800px;">
  <!-- Main Article -->
  <div class="mb-5">
    <h1 class="mb-3">{{ article['Title'] }}</h1>
    <img src="{{ article['Image URL'] or 'https://placehold.co/600x400?text=No+Image' }}" class="img-fluid mb-2">

    <!-- Label + Tooltip (only if user has selected a labeled article) -->
    {% if show_label and condition in ['color', 'no_color', 'c2pa'] %}
    <div class="d-inline-flex align-items-center gap-2 mb-3">
      {% if condition == 'color' %}
        <img src="{{ url_for('static', filename='images/imagetrustscoreCOLOUR.png') }}"
             alt="Transparency Score Label"
             style="height: 80px; cursor: pointer;"
             data-bs-toggle="collapse" data-bs-target="#scoreExplanation"
             aria-expanded="false" aria-controls="scoreExplanation">
      {% elif condition == 'no_color' %}
        <img src="{{ url_for('static', filename='images/imagetrustscoreBW.png') }}"
             alt="Transparency Score Label"
             style="height: 80px; cursor: pointer;"
             data-bs-toggle="collapse" data-bs-target="#scoreExplanation"
             aria-expanded="false" aria-controls="scoreExplanation">
      {% elif condition == 'c2pa' %}
        <img src="{{ url_for('static', filename='images/' + cr_label) }}"
             alt="C2PA Label"
             style="height: 80px; cursor: pointer;"
             data-bs-toggle="collapse" data-bs-target="#c2paExplanation"
             aria-expanded="false" aria-controls="c2paExplanation">
      {% endif %}
      <span class="badge bg-secondary rounded-circle label-badge"
            title="Click for explanation"
            data-bs-toggle="collapse"
            data-bs-target="#{{ 'scoreExplanation' if condition != 'c2pa' else 'c2paExplanation' }}"
            aria-expanded="false"
            aria-controls="{{ 'scoreExplanation' if condition != 'c2pa' else 'c2paExplanation' }}">?</span>
    </div>
    {% endif %}

    <!-- Explanation Panels (only if show_label is True) -->
    {% if show_label %}
      {% if condition != 'c2pa' %}
      <div class="collapse" id="scoreExplanation">
        <div class="card card-body border border-success rounded bg-light mb-3 py-3">
          <strong>What is the Image Trust Score?</strong><br>
          This score rates how transparent and trustworthy the image is — based on 7 criteria, such as author identity,
          media asset verification, and edit history.
          <ul class="mb-0 mt-2">
            <li><strong>A</strong>: High transparency and verified information</li>
            <li><strong>B–C</strong>: Some elements missing or unclear</li>
            <li><strong>D–E</strong>: Poor or no transparency indicators</li>
          </ul>
        </div>
      </div>
      {% else %}
      <div class="collapse" id="c2paExplanation">
        <div class="card card-body border border-success rounded bg-light mb-3 py-3">
          <strong>What does this label mean?</strong><br>
          These Content Credentials present a "digital nutrition label", provided by the news source.
          In a real-life setting, you could access verified details about the image by clicking on this label, such as:
          <ul class="mb-0 mt-2">
            <li>the creator</li>
            <li>the creation date and time</li>
            <li>location</li>
            <li>any edits made to the original</li>
          </ul>
        </div>
      </div>
      {% endif %}
    {% endif %}

    <p class="article_content">{{ article['Content'] }}</p>
  </div>

  <!-- Recommendations -->
  <h3>Recommended</h3>
  <form method="POST">
    <input type="hidden" name="label_explained" id="label_explained" value="false">
    <input type="hidden" name="selected_article_had_label" id="selected_article_had_label" value="false">

    <div class="vstack gap-3">
      {% for rec in recommendations %}
      <button type="submit"
              name="selected_article_id"
              value="{{ rec['index'] }}"
              class="card text-start py-3 px-3 border-0 shadow-sm text-decoration-none text-body recommendation-card"
              onclick="document.getElementById('selected_article_had_label').value = '{{ 'true' if rec['index'] in label_shown_ids else 'false' }}';">
        <div class="row g-3 align-items-center">
          <div class="col-md-8">
            <h3 class="mb-0 fw-bold" style="font-size: 1.5rem;">{{ rec['Title'] }}</h3>
            <p class="card-text text-muted small mb-0"></p>
          </div>
          <div class="col-md-4">
            <img src="{{ rec['Image URL'] or 'https://placehold.co/300x180?text=No+Image' }}"
                 alt="{{ rec['Title'] }}"
                 class="img-fluid rounded mb-2"
                 style="max-height: 180px; object-fit: cover;">

            {% if rec['index'] in label_shown_ids %}
              {% if condition == 'color' %}
                <img src="{{ url_for('static', filename='images/itsCOLOUR.png') }}"
                     alt="Label: Color" style="height: 30px;">
              {% elif condition == 'no_color' %}
                <img src="{{ url_for('static', filename='images/itsBW.png') }}"
                     alt="Label: No Color" style="height: 30px;">
              {% elif condition == 'c2pa' %}
                <img src="{{ url_for('static', filename='images/cr_logo.png') }}"
                     alt="Label: C2PA" style="height: 30px;">
              {% endif %}
            {% endif %}
          </div>
        </div>
      </button>
      {% endfor %}
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const collapseEl = document.getElementById('{{ "scoreExplanation" if condition != "c2pa" else "c2paExplanation" }}');
    const labelExplainedInput = document.getElementById('label_explained');

    if (collapseEl && labelExplainedInput) {
      collapseEl.addEventListener('shown.bs.collapse', () => {
        labelExplainedInput.value = 'true';
      });
    }
  });
</script>
</body>
</html>
