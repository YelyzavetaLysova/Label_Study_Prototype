<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ article['Title'] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .article_label {
            width: auto;
            height: 4.5em;
            object-fit: cover;
            margin-bottom: 1em;
        }

        .article_label img {
            height: 100%;
            width: auto;
            object-fit: contain;
        }

        .article_content {
            font-size: medium;
        }

        #scoreExplanation .card-body {
            padding: 1.25rem;
            background-color: #f8f9fa;
            border-left: 5px solid #198754;
        }

        .recommendation-card {
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
        }

        .transp-label {
            height: 30px;
            vertical-align: bottom;
            align-self: end;
        }

        .cr-wrapper {
            border-bottom: 1px solid #ccc;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            width: inherit;
            align-content: start;
        }

        .cr-label {
            height: 80px;
            display: block;
        }
    </style>
</head>
<body class="container mt-5">
<div class="d-flex justify-content-center mb-4">
    <div class="alert alert-primary text-center h4 mb-0 px-4 py-3" role="alert">
        <strong>Task:</strong> Please read the article carefully, then choose one of the recommended related articles below.
    </div>
</div>

<div class="mx-auto" style="max-width: 800px;">
    <!-- Main Article -->
    <div class="mb-5">
        <h1 class="mb-3">{{ article['Title'] }}</h1>
        <img src="{{ article['Image URL'] or 'https://placehold.co/600x400?text=No+Image' }}" class="img-fluid">

        <div class="mb-3 article_label">
            {% if condition == 'color' %}
                <img src="{{ url_for('static', filename='images/imagetrustscoreCOLOUR.png') }}"
                     alt="Transparency Score Label" class="mt-2 mb-2" style="cursor: pointer;"
                     data-bs-toggle="collapse" data-bs-target="#scoreExplanation"
                     aria-expanded="false" aria-controls="scoreExplanation">
            {% elif condition == 'no_color' %}
                <img src="{{ url_for('static', filename='images/imagetrustscoreBW.png') }}"
                     alt="Transparency Score Label" class="mt-2 mb-2" style="cursor: pointer;"
                     data-bs-toggle="collapse" data-bs-target="#scoreExplanation"
                     aria-expanded="false" aria-controls="scoreExplanation">
            {% elif condition == 'c2pa' %}
                <div class="cr-wrapper">
                  <img src="{{ url_for('static', filename='images/' + cr_label) }}"
                      alt="C2PA Label" class="cr-label" style="height: 80px;"
                      data-bs-toggle="collapse" data-bs-target="#c2paExplanation"
                      aria-expanded="false" aria-controls="c2paExplanation">
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-circle bg-secondary" style="font-size: 0.75rem; width: 1.5rem; height: 1.5rem; line-height: 1.5rem; text-align: center;">?</span>
                </div>
            {% endif %}
        </div>
        {% if condition != 'c2pa' %}
        <div class="collapse" id="scoreExplanation">
            <div class="card card-body border border-success rounded bg-light mb-3 py-3">
                <strong>What is the Image Trust Score?</strong><br>
                This score rates how transparent and trustworthy the image is — based on 7 criteria,
                such as author identity, media asset verification, and edit history.
                <ul class="mb-0 mt-2">
                    <li><strong>A</strong>: High transparency and verified information</li>
                    <li><strong>B–C</strong>: Some elements missing or unclear</li>
                    <li><strong>D–E</strong>: Poor or no transparency indicators</li>
                </ul>
            </div>
        </div>
        {% elif condition == 'c2pa' %}
        <div class="collapse" id="c2paExplanation">
          <div class="card card-body border border-success rounded bg-light mb-3 py-3">
              <strong>What does this label mean?</strong><br>
              You may have seen nutrition labels on food items in the supermarket before. These Content Credentials present a "digital nutrition label", provided by the news source. In a real-life setting, you could access verified details about the image by clicking on this label, such as
              <ul class="mb-0 mt-2">
                  <li>the creator</li>
                  <li>the creation date and time</li>
                  <li>location</li>
                  <li>and any edits made to the original</li>
              </ul>
            </div>
        </div>
        {% endif %}

        <p class="article_content">{{ article['Content'] }}</p>
    </div>

    <!-- Recommended Articles -->
<h3>Recommended</h3>
<form method="POST">
    <input type="hidden" name="label_explained" id="label_explained" value="false">
    <input type="hidden" name="selected_article_had_label" id="selected_article_had_label" value="false">

    <div class="vstack gap-3">
        {% for rec in recommendations %}
        <button type="submit"
                name="selected_article_id"
                value="{{ rec['index'] }}"
                class="card text-start py-3 px-3 border-0 shadow-sm text-decoration-none text-body recommendation-card"
                onclick="document.getElementById('selected_article_had_label').value = '{{ 'true' if rec['index'] in label_shown_ids else 'false' }}';">
            <div class="row g-3 align-items-center">
                <div class="col-md-8">
                    <h5 class="card-title mb-2">{{ rec['Title'] }}</h5>
                    <p class="card-text text-muted small mb-0">
                        {{ rec['Content'][:300] }}...
                    </p>
                </div>
                <div class="col-md-4">
                    <!-- Image -->
                    <img src="{{ rec['Image URL'] or 'https://placehold.co/300x180?text=No+Image' }}"
                         alt="{{ rec['Title'] }}"
                         class="img-fluid rounded mb-2"
                         style="max-height: 180px; object-fit: cover;">

                    <!-- Label directly under image, left-aligned -->
                    {% if rec['index'] in label_shown_ids %}
                        {% if condition == 'color' %}
                            <div class="d-flex align-items-start">
                                <img src="{{ url_for('static', filename='images/itsCOLOUR.png') }}"
                                     alt="Label: Color" style="height: 30px;">
                            </div>
                        {% elif condition == 'no_color' %}
                            <div class="d-flex align-items-start">
                                <img src="{{ url_for('static', filename='images/itsBW.png') }}"
                                     alt="Label: No Color" style="height: 30px;">
                            </div>
                        {% elif condition == 'c2pa' %}
                            <div class="d-flex align-items-start">
                                <img src="{{ url_for('static', filename='images/cr_logo.png') }}"
                                     alt="Label: C2PA" style="height: 30px;">
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </button>
        {% endfor %}
    </div>
</form>



</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const collapseEl = document.getElementById('scoreExplanation');
        const labelExplainedInput = document.getElementById('label_explained');

        if (collapseEl && labelExplainedInput) {
            collapseEl.addEventListener('shown.bs.collapse', () => {
                labelExplainedInput.value = 'true';
            });
        }

        const labelImage = document.querySelector('.article_label img');
        document.addEventListener('click', function (event) {
            if (!collapseEl.contains(event.target) && !labelImage.contains(event.target)) {
                const bsCollapse = bootstrap.Collapse.getInstance(collapseEl);
                if (bsCollapse && collapseEl.classList.contains('show')) {
                    bsCollapse.hide();
                }
            }
        });
    });
</script>
</body>
</html>
